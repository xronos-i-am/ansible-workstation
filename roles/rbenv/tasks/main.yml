- name: Make dir
  file:
    path: ~{{ user }}/.rbenv
    state: directory
    owner: "{{ user }}"
    group: "{{ user }}"

- name: Download
  get_url:
    url: https://github.com/rbenv/rbenv-installer/raw/HEAD/bin/rbenv-installer
    dest: ~{{ user }}/.rbenv/rbenv-installer
    owner: "{{ user }}"
    group: "{{ user }}"
    mode: "755"

- name: Install
  shell: ~{{ user }}/.rbenv/rbenv-installer
  become: yes
  become_user: "{{user}}"
  args:
    executable: "/bin/bash"

- name: Clone ruby-build
  git: 
    repo: https://github.com/rbenv/ruby-build.git
    dest: ~{{ user }}/.rbenv/plugins/ruby-build
    force: true

- name: Install rbenv loader script
  copy:
    src: ../templates/rbenv.sh
    dest: /etc/profile.d/rbenv.sh
    owner: root
    mode: 0755
